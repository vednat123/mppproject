<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LU Decomposition Visualizer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h2 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #667eea;
        }

        .subtitle {
            opacity: 0.8;
            font-size: 1.1rem;
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: transparent;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .info-box {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .info-box h3 {
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .info-box p {
            opacity: 0.85;
            line-height: 1.6;
        }

        .equation {
            text-align: center;
            font-size: 1.5rem;
            margin: 1rem 0;
            font-family: 'Times New Roman', serif;
            font-style: italic;
        }

        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        select, button {
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        select:hover, button:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        button.primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            font-weight: 600;
        }

        button.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .matrices-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .matrix-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
        }

        .matrix-card h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .matrix-card h3 span {
            font-size: 0.8rem;
            opacity: 0.6;
            font-weight: normal;
        }

        .matrix {
            display: inline-block;
            position: relative;
            padding: 0.5rem 1rem;
        }

        .matrix::before,
        .matrix::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 8px;
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        .matrix::before {
            left: 0;
            border-right: none;
            border-radius: 4px 0 0 4px;
        }

        .matrix::after {
            right: 0;
            border-left: none;
            border-radius: 0 4px 4px 0;
        }

        .matrix-grid {
            display: grid;
            gap: 4px;
        }

        .matrix-cell {
            width: 60px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            font-family: 'Consolas', monospace;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .matrix-cell.input {
            background: rgba(255, 255, 255, 0.1);
        }

        .matrix-cell input {
            width: 100%;
            height: 100%;
            background: transparent;
            border: none;
            color: #fff;
            text-align: center;
            font-family: inherit;
            font-size: inherit;
        }

        .matrix-cell input:focus {
            outline: none;
            background: rgba(102, 126, 234, 0.2);
        }

        .matrix-cell.highlight {
            background: rgba(102, 126, 234, 0.4);
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.5);
        }

        .matrix-cell.pivot {
            background: rgba(118, 75, 162, 0.5);
            box-shadow: 0 0 15px rgba(118, 75, 162, 0.5);
        }

        .matrix-cell.computed {
            background: rgba(67, 233, 123, 0.3);
        }

        .step-display {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .step-display h3 {
            margin-bottom: 1rem;
            color: #667eea;
        }

        .step-text {
            font-size: 1.1rem;
            line-height: 1.6;
            min-height: 3rem;
        }

        .step-formula {
            font-family: 'Consolas', monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-size: 1rem;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 1rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .speed-control input[type="range"] {
            width: 100px;
            cursor: pointer;
        }

        /* Benchmark Section Styles */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
        }

        .chart-card h3 {
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .benchmark-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-top: 0.25rem;
        }

        .test-env {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .test-env-item {
            font-size: 0.9rem;
        }

        .test-env-item strong {
            color: #667eea;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .data-table th,
        .data-table td {
            padding: 0.75rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-table th {
            background: rgba(102, 126, 234, 0.2);
            font-weight: 600;
        }

        .data-table tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.03);
        }

        .data-table .best {
            color: #43e97b;
            font-weight: 600;
        }

        footer {
            text-align: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0.7;
        }

        footer a {
            color: #667eea;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            h1 {
                font-size: 1.8rem;
            }

            .matrix-cell {
                width: 50px;
                height: 35px;
                font-size: 0.85rem;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>LU Decomposition Visualizer</h1>
            <p class="subtitle">Interactive visualization & performance benchmarks</p>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('algorithm')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="3" y1="9" x2="21" y2="9"></line>
                    <line x1="3" y1="15" x2="21" y2="15"></line>
                    <line x1="9" y1="3" x2="9" y2="21"></line>
                    <line x1="15" y1="3" x2="15" y2="21"></line>
                </svg>
                Algorithm Demo
            </button>
            <button class="tab" onclick="switchTab('benchmarks')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
                    <line x1="18" y1="20" x2="18" y2="10"></line>
                    <line x1="12" y1="20" x2="12" y2="4"></line>
                    <line x1="6" y1="20" x2="6" y2="14"></line>
                </svg>
                Benchmark Results
            </button>
        </div>

        <!-- Algorithm Demo Section -->
        <div id="algorithm-section" class="section active">
            <div class="info-box">
                <h3>What is LU Decomposition?</h3>
                <p>
                    LU decomposition factors a matrix <strong>A</strong> into the product of a 
                    <strong>lower triangular matrix (L)</strong> and an <strong>upper triangular matrix (U)</strong>.
                    This is useful for solving systems of linear equations, computing determinants, and matrix inversion.
                </p>
                <div class="equation">A = L × U</div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label for="size">Matrix Size:</label>
                    <select id="size">
                        <option value="3">3 × 3</option>
                        <option value="4" selected>4 × 4</option>
                        <option value="5">5 × 5</option>
                    </select>
                </div>
                
                                <button onclick="generateRandom()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                        <rect x="2" y="2" width="20" height="20" rx="2"></rect>
                        <circle cx="8" cy="8" r="1.5" fill="currentColor"></circle>
                        <circle cx="16" cy="8" r="1.5" fill="currentColor"></circle>
                        <circle cx="8" cy="16" r="1.5" fill="currentColor"></circle>
                        <circle cx="16" cy="16" r="1.5" fill="currentColor"></circle>
                        <circle cx="12" cy="12" r="1.5" fill="currentColor"></circle>
                    </svg>
                    Random
                </button>
                                <button onclick="resetDemo()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                        <path d="M3 3v5h5"></path>
                    </svg>
                    Reset
                </button>
                                <button class="primary" onclick="startDecomposition()" id="startBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="none" style="margin-right: 6px;">
                        <polygon points="5,3 19,12 5,21"></polygon>
                    </svg>
                    Start Decomposition
                </button>
                
                <div class="speed-control">
                    <label>Speed:</label>
                    <input type="range" id="speed" min="1" max="10" value="5">
                    <span id="speedLabel">1x</span>
                </div>
            </div>

            <div class="matrices-container">
                <div class="matrix-card">
                    <h3>Matrix A <span>(Input)</span></h3>
                    <div class="matrix">
                        <div class="matrix-grid" id="matrixA"></div>
                    </div>
                </div>

                <div class="matrix-card">
                    <h3>Matrix L <span>(Lower Triangular)</span></h3>
                    <div class="matrix">
                        <div class="matrix-grid" id="matrixL"></div>
                    </div>
                </div>

                <div class="matrix-card">
                    <h3>Matrix U <span>(Upper Triangular)</span></h3>
                    <div class="matrix">
                        <div class="matrix-grid" id="matrixU"></div>
                    </div>
                </div>
            </div>

            <div class="step-display">
                <h3>Current Step</h3>
                <div class="step-text" id="stepText">
                    Enter values in Matrix A or generate a random matrix, then click "Start Decomposition" to begin.
                </div>
                <div class="step-formula" id="stepFormula" style="display: none;"></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Benchmarks Section -->
        <div id="benchmarks-section" class="section">
            <div class="info-box">
                <h3>Performance Analysis</h3>
                <p>
                    Real benchmark results comparing Sequential, OpenMP, and Pthreads implementations 
                    on various matrix sizes and thread counts. Tests performed on actual hardware to 
                    measure parallelization efficiency.
                </p>
                <div class="test-env">
                    <div class="test-env-item"><strong>CPU:</strong> Ryzen 9 5900HS (8C/16T)</div>
                    <div class="test-env-item"><strong>RAM:</strong> 16 GB</div>
                    <div class="test-env-item"><strong>OS:</strong> Ubuntu 24.04</div>
                    <div class="test-env-item"><strong>Compiler:</strong> GCC 14.1 -O3</div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">6.2×</div>
                    <div class="stat-label">Peak OpenMP Speedup</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">3.1×</div>
                    <div class="stat-label">Peak Pthreads Speedup</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">8</div>
                    <div class="stat-label">Optimal Thread Count</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">O(N³)</div>
                    <div class="stat-label">Algorithm Complexity</div>
                </div>
            </div>

            <div class="benchmark-controls">
                <div class="control-group">
                    <label for="chartType">View:</label>
                    <select id="chartType" onchange="updateCharts()">
                        <option value="runtime">Runtime Comparison</option>
                        <option value="speedup">Speedup Analysis</option>
                    </select>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-card">
                    <h3>OpenMP Performance</h3>
                    <div class="chart-container">
                        <canvas id="ompChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>Pthreads Performance</h3>
                    <div class="chart-container">
                        <canvas id="pthreadChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="chart-card" style="margin-bottom: 2rem;">
                <h3>OpenMP vs Pthreads — Best Speedup Comparison</h3>
                <div class="chart-container" style="height: 350px;">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3>Detailed Results</h3>
                <h4 style="margin: 1rem 0 0.5rem; opacity: 0.8;">OpenMP Runtimes (seconds)</h4>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Matrix Size</th>
                                <th>Sequential</th>
                                <th>1 Thread</th>
                                <th>2 Threads</th>
                                <th>4 Threads</th>
                                <th>8 Threads</th>
                                <th>16 Threads</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>500×500</td>
                                <td>0.0255</td>
                                <td>0.0141</td>
                                <td>0.0082</td>
                                <td class="best">0.0061</td>
                                <td>0.0066</td>
                                <td>0.0307</td>
                            </tr>
                            <tr>
                                <td>1000×1000</td>
                                <td>0.2021</td>
                                <td>0.1065</td>
                                <td>0.0558</td>
                                <td>0.0471</td>
                                <td class="best">0.0327</td>
                                <td>0.0612</td>
                            </tr>
                            <tr>
                                <td>1500×1500</td>
                                <td>1.1206</td>
                                <td>0.7358</td>
                                <td>0.3470</td>
                                <td class="best">0.2036</td>
                                <td>0.2868</td>
                                <td>0.3013</td>
                            </tr>
                            <tr>
                                <td>2000×2000</td>
                                <td>2.9234</td>
                                <td>2.7630</td>
                                <td>2.0936</td>
                                <td>1.8705</td>
                                <td class="best">1.6748</td>
                                <td>2.5432</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h4 style="margin: 1.5rem 0 0.5rem; opacity: 0.8;">Pthreads Runtimes (seconds)</h4>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Matrix Size</th>
                                <th>Sequential</th>
                                <th>1 Thread</th>
                                <th>2 Threads</th>
                                <th>4 Threads</th>
                                <th>8 Threads</th>
                                <th>16 Threads</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>500×500</td>
                                <td>0.0255</td>
                                <td class="best">0.0118</td>
                                <td>0.0278</td>
                                <td>0.0496</td>
                                <td>0.0875</td>
                                <td>0.1669</td>
                            </tr>
                            <tr>
                                <td>1000×1000</td>
                                <td>0.2021</td>
                                <td>0.0990</td>
                                <td class="best">0.0920</td>
                                <td>0.1188</td>
                                <td>0.2212</td>
                                <td>0.3476</td>
                            </tr>
                            <tr>
                                <td>1500×1500</td>
                                <td>1.1206</td>
                                <td>0.7468</td>
                                <td>0.4443</td>
                                <td class="best">0.3638</td>
                                <td>0.5221</td>
                                <td>0.7597</td>
                            </tr>
                            <tr>
                                <td>2000×2000</td>
                                <td>2.9234</td>
                                <td>2.5724</td>
                                <td class="best">1.4303</td>
                                <td>1.4503</td>
                                <td>1.6226</td>
                                <td>1.9806</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <footer>
            <p>
                Built by <a href="https://github.com/vednat123" target="_blank">Vedant Trivedi</a> |
                View the <a href="https://github.com/vednat123/mppproject" target="_blank">C/OpenMP/Pthreads source code</a>
            </p>
        </footer>
    </div>

    <script>
        // ==================== TAB SWITCHING ====================
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + '-section').classList.add('active');

            if (tab === 'benchmarks' && !chartsInitialized) {
                initCharts();
                chartsInitialized = true;
            }
        }

        // ==================== BENCHMARK DATA ====================
        const benchmarkData = {
            sizes: [500, 1000, 1500, 2000],
            threads: [1, 2, 4, 8, 16],
            sequential: [0.0255, 0.2021, 1.1206, 2.9234],
            openmp: {
                1: [0.0141, 0.1065, 0.7358, 2.7630],
                2: [0.0082, 0.0558, 0.3470, 2.0936],
                4: [0.0061, 0.0471, 0.2036, 1.8705],
                8: [0.0066, 0.0327, 0.2868, 1.6748],
                16: [0.0307, 0.0612, 0.3013, 2.5432]
            },
            pthreads: {
                1: [0.0118, 0.0990, 0.7468, 2.5724],
                2: [0.0278, 0.0920, 0.4443, 1.4303],
                4: [0.0496, 0.1188, 0.3638, 1.4503],
                8: [0.0875, 0.2212, 0.5221, 1.6226],
                16: [0.1669, 0.3476, 0.7597, 1.9806]
            }
        };

        const ompColors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe'];
        const pthreadColors = ['#43e97b', '#38f9d7', '#fa709a', '#fee140', '#a8edea'];

        let ompChart, pthreadChart, comparisonChart;
        let chartsInitialized = false;

        function initCharts() {
            // OpenMP Chart
            const ompCtx = document.getElementById('ompChart').getContext('2d');
            ompChart = new Chart(ompCtx, {
                type: 'line',
                data: getChartData('openmp', ompColors),
                options: getChartOptions('Runtime (seconds)')
            });

            // Pthreads Chart
            const pthreadCtx = document.getElementById('pthreadChart').getContext('2d');
            pthreadChart = new Chart(pthreadCtx, {
                type: 'line',
                data: getChartData('pthreads', pthreadColors),
                options: getChartOptions('Runtime (seconds)')
            });

            // Comparison Chart
            const compCtx = document.getElementById('comparisonChart').getContext('2d');
            comparisonChart = new Chart(compCtx, {
                type: 'bar',
                data: {
                    labels: benchmarkData.sizes.map(s => s + '×' + s),
                    datasets: [{
                        label: 'OpenMP Best Speedup',
                        data: benchmarkData.sizes.map((_, i) => {
                            const best = Math.min(...benchmarkData.threads.map(t => benchmarkData.openmp[t][i]));
                            return (benchmarkData.sequential[i] / best).toFixed(2);
                        }),
                        backgroundColor: 'rgba(102, 126, 234, 0.7)',
                        borderColor: '#667eea',
                        borderWidth: 2
                    }, {
                        label: 'Pthreads Best Speedup',
                        data: benchmarkData.sizes.map((_, i) => {
                            const best = Math.min(...benchmarkData.threads.map(t => benchmarkData.pthreads[t][i]));
                            return (benchmarkData.sequential[i] / best).toFixed(2);
                        }),
                        backgroundColor: 'rgba(67, 233, 123, 0.7)',
                        borderColor: '#43e97b',
                        borderWidth: 2
                    }]
                },
                options: {
                    ...getChartOptions('Speedup (×)'),
                    plugins: {
                        legend: {
                            labels: { color: '#fff', font: { size: 12 } }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.raw + '×';
                                }
                            }
                        }
                    }
                }
            });
        }

        function getChartData(type, colors) {
            const data = benchmarkData[type];
            return {
                labels: benchmarkData.sizes.map(s => s + '×' + s),
                datasets: [{
                    label: 'Sequential',
                    data: benchmarkData.sequential,
                    borderColor: '#ffffff',
                    backgroundColor: 'rgba(255,255,255,0.1)',
                    borderDash: [5, 5],
                    tension: 0.3,
                    pointRadius: 4
                }, ...benchmarkData.threads.map((t, i) => ({
                    label: t + ' Thread' + (t > 1 ? 's' : ''),
                    data: data[t],
                    borderColor: colors[i],
                    backgroundColor: colors[i] + '20',
                    tension: 0.3,
                    pointRadius: 4
                }))]
            };
        }

        function getChartOptions(yLabel) {
            return {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                plugins: {
                    legend: {
                        labels: {
                            color: '#fff',
                            font: { size: 11 },
                            usePointStyle: true
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: { color: '#fff' },
                        grid: { color: 'rgba(255,255,255,0.1)' },
                        title: {
                            display: true,
                            text: 'Matrix Size',
                            color: '#fff'
                        }
                    },
                    y: {
                        ticks: { color: '#fff' },
                        grid: { color: 'rgba(255,255,255,0.1)' },
                        title: {
                            display: true,
                            text: yLabel,
                            color: '#fff'
                        }
                    }
                }
            };
        }

        function updateCharts() {
            const chartType = document.getElementById('chartType').value;

            if (chartType === 'speedup') {
                updateChartToSpeedup(ompChart, 'openmp', ompColors);
                updateChartToSpeedup(pthreadChart, 'pthreads', pthreadColors);
            } else {
                ompChart.data = getChartData('openmp', ompColors);
                ompChart.options.scales.y.title.text = 'Runtime (seconds)';
                ompChart.update();

                pthreadChart.data = getChartData('pthreads', pthreadColors);
                pthreadChart.options.scales.y.title.text = 'Runtime (seconds)';
                pthreadChart.update();
            }
        }

        function updateChartToSpeedup(chart, type, colors) {
            const data = benchmarkData[type];
            chart.data = {
                labels: benchmarkData.sizes.map(s => s + '×' + s),
                datasets: benchmarkData.threads.map((t, i) => ({
                    label: t + ' Thread' + (t > 1 ? 's' : ''),
                    data: data[t].map((val, j) => (benchmarkData.sequential[j] / val).toFixed(2)),
                    borderColor: colors[i],
                    backgroundColor: colors[i] + '20',
                    tension: 0.3,
                    pointRadius: 4
                }))
            };
            chart.options.scales.y.title.text = 'Speedup (×)';
            chart.update();
        }

        // ==================== ALGORITHM DEMO ====================
        let size = 4;
        let matrixA = [];
        let matrixL = [];
        let matrixU = [];
        let isRunning = false;
        let animationSpeed = 500;

        document.addEventListener('DOMContentLoaded', () => {
            initMatrices();
            generateRandom();
            
            document.getElementById('size').addEventListener('change', (e) => {
                size = parseInt(e.target.value);
                initMatrices();
                generateRandom();
            });

            document.getElementById('speed').addEventListener('input', (e) => {
                const val = parseInt(e.target.value);
                animationSpeed = 1100 - (val * 100);
                document.getElementById('speedLabel').textContent = (val / 5).toFixed(1) + 'x';
            });
        });

        function initMatrices() {
            matrixA = Array(size).fill().map(() => Array(size).fill(0));
            matrixL = Array(size).fill().map(() => Array(size).fill(0));
            matrixU = Array(size).fill().map(() => Array(size).fill(0));
            
            renderMatrix('matrixA', matrixA, true);
            renderMatrix('matrixL', matrixL, false);
            renderMatrix('matrixU', matrixU, false);
        }

        function renderMatrix(elementId, matrix, editable = false) {
            const container = document.getElementById(elementId);
            container.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
            container.innerHTML = '';

            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'matrix-cell' + (editable ? ' input' : '');
                    cell.id = `${elementId}-${i}-${j}`;

                    if (editable) {
                        const input = document.createElement('input');
                        input.type = 'number';
                        input.value = matrix[i][j];
                        input.addEventListener('change', (e) => {
                            matrix[i][j] = parseFloat(e.target.value) || 0;
                        });
                        cell.appendChild(input);
                    } else {
                        cell.textContent = formatNumber(matrix[i][j]);
                    }

                    container.appendChild(cell);
                }
            }
        }

        function formatNumber(num) {
            if (num === 0) return '0';
            if (Math.abs(num) < 0.001) return num.toExponential(1);
            return Math.round(num * 1000) / 1000;
        }

        function generateRandom() {
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    matrixA[i][j] = Math.floor(Math.random() * 19) - 9;
                }
            }
            for (let i = 0; i < size; i++) {
                if (matrixA[i][i] === 0) matrixA[i][i] = Math.floor(Math.random() * 5) + 1;
            }
            renderMatrix('matrixA', matrixA, true);
            resetLU();
        }

        function resetLU() {
            matrixL = Array(size).fill().map(() => Array(size).fill(0));
            matrixU = Array(size).fill().map(() => Array(size).fill(0));
            renderMatrix('matrixL', matrixL, false);
            renderMatrix('matrixU', matrixU, false);
            document.getElementById('progress').style.width = '0%';
            document.getElementById('stepText').textContent = 'Ready to start decomposition.';
            document.getElementById('stepFormula').style.display = 'none';
            clearHighlights();
        }

        function resetDemo() {
            isRunning = false;
            document.getElementById('startBtn').disabled = false;
            resetLU();
        }

        function clearHighlights() {
            document.querySelectorAll('.matrix-cell').forEach(cell => {
                cell.classList.remove('highlight', 'pivot', 'computed');
            });
        }

        function highlightCell(matrixId, i, j, type = 'highlight') {
            const cell = document.getElementById(`${matrixId}-${i}-${j}`);
            if (cell) cell.classList.add(type);
        }

        function updateCell(matrixId, matrix, i, j) {
            const cell = document.getElementById(`${matrixId}-${i}-${j}`);
            if (cell) {
                cell.textContent = formatNumber(matrix[i][j]);
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function startDecomposition() {
            if (isRunning) return;
            isRunning = true;
            document.getElementById('startBtn').disabled = true;

            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    const input = document.querySelector(`#matrixA-${i}-${j} input`);
                    if (input) matrixA[i][j] = parseFloat(input.value) || 0;
                }
            }

            resetLU();
            
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    matrixU[i][j] = matrixA[i][j];
                }
            }
            renderMatrix('matrixU', matrixU, false);

            for (let i = 0; i < size; i++) {
                matrixL[i][i] = 1;
            }
            renderMatrix('matrixL', matrixL, false);

            const totalSteps = (size * (size - 1)) / 2;
            let currentStep = 0;

            document.getElementById('stepText').textContent = 'Starting LU Decomposition...';
            document.getElementById('stepFormula').style.display = 'block';
            await sleep(animationSpeed);

            for (let k = 0; k < size - 1; k++) {
                clearHighlights();
                
                highlightCell('matrixU', k, k, 'pivot');
                document.getElementById('stepText').textContent = 
                    `Column ${k + 1}: Using pivot element U[${k + 1}][${k + 1}] = ${formatNumber(matrixU[k][k])}`;
                document.getElementById('stepFormula').textContent = 
                    `Pivot position: (${k + 1}, ${k + 1})`;
                await sleep(animationSpeed);

                if (Math.abs(matrixU[k][k]) < 1e-10) {
                    document.getElementById('stepText').textContent = 
                        `Warning: Near-zero pivot detected. Matrix may be singular.`;
                    await sleep(animationSpeed * 2);
                }

                for (let i = k + 1; i < size; i++) {
                    if (!isRunning) return;

                    clearHighlights();
                    highlightCell('matrixU', k, k, 'pivot');
                    highlightCell('matrixU', i, k, 'highlight');

                    const multiplier = matrixU[i][k] / matrixU[k][k];
                    matrixL[i][k] = multiplier;

                    document.getElementById('stepText').innerHTML = 
                        `Row ${i + 1}: Calculate multiplier L[${i + 1}][${k + 1}] = U[${i + 1}][${k + 1}] / U[${k + 1}][${k + 1}]<br>` +
                        `= ${formatNumber(matrixU[i][k])} / ${formatNumber(matrixU[k][k])} = <strong>${formatNumber(multiplier)}</strong>`;
                    document.getElementById('stepFormula').textContent = 
                        `L[${i + 1}][${k + 1}] = ${formatNumber(multiplier)}`;

                    updateCell('matrixL', matrixL, i, k);
                    highlightCell('matrixL', i, k, 'computed');

                    await sleep(animationSpeed);

                    for (let j = k; j < size; j++) {
                        matrixU[i][j] = matrixU[i][j] - multiplier * matrixU[k][j];
                        updateCell('matrixU', matrixU, i, j);
                        highlightCell('matrixU', i, j, 'computed');
                    }

                    document.getElementById('stepText').innerHTML = 
                        `Row ${i + 1}: Subtract ${formatNumber(multiplier)} × Row ${k + 1} from Row ${i + 1}<br>` +
                        `Row ${i + 1} = Row ${i + 1} - (${formatNumber(multiplier)}) × Row ${k + 1}`;

                    currentStep++;
                    const progress = (currentStep / totalSteps) * 100;
                    document.getElementById('progress').style.width = progress + '%';

                    await sleep(animationSpeed);
                }
            }

            clearHighlights();
            document.getElementById('stepText').innerHTML = 
                `<strong><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#43e97b" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;"><polyline points="20 6 9 17 4 12"></polyline></svg>Decomposition Complete!</strong><br>` +
                `Matrix A has been factored into L × U`;
            document.getElementById('stepFormula').textContent = 'A = L × U';
            document.getElementById('progress').style.width = '100%';

            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    if (i > j) highlightCell('matrixL', i, j, 'computed');
                    if (i <= j) highlightCell('matrixU', i, j, 'computed');
                }
            }

            isRunning = false;
            document.getElementById('startBtn').disabled = false;
        }
    </script>
</body>
</html>
